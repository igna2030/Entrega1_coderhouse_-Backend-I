<div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-6 text-center text-indigo-700">Catálogo de Productos</h1>
    
    <div class="bg-gray-100 p-4 rounded-lg shadow-md mb-6 flex flex-wrap gap-4 items-end">
        <form id="filter-form" action="/products" method="GET" class="flex flex-wrap gap-4 items-end w-full">
            <div class="flex flex-col">
                <label for="limit" class="text-sm font-medium text-gray-700">Límite por página:</label>
                <input type="number" name="limit" id="limit" value="{{currentLimit}}" class="mt-1 p-2 border border-gray-300 rounded-md w-24">
            </div>
            
            <div class="flex flex-col">
                <label for="page" class="text-sm font-medium text-gray-700">Página actual ({{currentPage}} de {{totalPages}}):</label>
                <input type="number" name="page" id="page" value="{{currentPage}}" min="1" max="{{totalPages}}" class="mt-1 p-2 border border-gray-300 rounded-md w-24">
            </div>

            <div class="flex flex-col">
                <label for="sort" class="text-sm font-medium text-gray-700">Ordenar por Precio:</label>
                <select name="sort" id="sort" class="mt-1 p-2 border border-gray-300 rounded-md">
                    <option value="" {{#unless currentSort}}selected{{/unless}}>Sin Orden</option>
                    <option value="asc" {{#if (eq currentSort 'asc')}}selected{{/if}}>Ascendente (Menor a Mayor)</option>
                    <option value="desc" {{#if (eq currentSort 'desc')}}selected{{/if}}>Descendente (Mayor a Menor)</option>
                </select>
            </div>

            <div class="flex flex-col">
                <label for="query" class="text-sm font-medium text-gray-700">Filtro (category:valor o stock:available):</label>
                <input type="text" name="query" id="query" value="{{currentQuery}}" placeholder="Ej: category:ropa" class="mt-1 p-2 border border-gray-300 rounded-md w-48">
            </div>
            
            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition duration-150 shadow-md">Aplicar Filtros</button>
            <a href="/products" class="bg-gray-400 text-white px-4 py-2 rounded-md hover:bg-gray-500 transition duration-150 shadow-md">Limpiar Filtros</a>
        </form>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        {{#each products}}
        <div class="bg-white p-4 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 border border-gray-200">
            <h2 class="text-xl font-semibold text-gray-800 truncate mb-2">{{title}}</h2>
            <p class="text-sm text-gray-600 mb-3">{{description}}</p>
            <p class="text-2xl font-bold text-green-600 mb-3">\${{price}}</p>
            <p class="text-sm text-gray-500">Stock: {{stock}} | Categoría: {{category}}</p>
            <div class="mt-4 flex flex-col space-y-2">
                <a href="/products/{{_id}}" class="text-center bg-blue-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-blue-600 transition duration-150">Ver Detalle</a>
                <button 
                    class="btn-add-to-cart text-center bg-green-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-green-600 transition duration-150"
                    data-product-id="{{_id}}"
                    onclick="alert('Funcionalidad de agregar al carrito (POST) aún no implementada en el cliente.')">
                    Añadir al Carrito
                </button>
            </div>
        </div>
        {{else}}
        <p class="col-span-full text-center text-lg text-gray-500">No se encontraron productos con los filtros aplicados.</p>
        {{/each}}
    </div>

    <div class="mt-8 flex justify-center items-center space-x-4">
        {{#if hasPrevPage}}
        <a href="{{prevLink}}" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400 transition duration-150">Página Anterior</a>
        {{else}}
        <span class="bg-gray-200 text-gray-500 px-4 py-2 rounded-lg cursor-not-allowed">Página Anterior</span>
        {{/if}}

        <span class="text-xl font-semibold text-gray-700">Página {{currentPage}} de {{totalPages}}</span>

        {{#if hasNextPage}}
        <a href="{{nextLink}}" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition duration-150">Página Siguiente</a>
        {{else}}
        <span class="bg-gray-200 text-gray-500 px-4 py-2 rounded-lg cursor-not-allowed">Página Siguiente</span>
        {{/if}}
    </div>
</div>
